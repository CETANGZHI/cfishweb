import{u as A,e as M,d as R,r,j as e,f as j}from"./index-C8wrHQVv.js";import{N as f}from"./NFTCard-BNEZSIRD.js";import{M as E}from"./Modal-B5K59-TF.js";import"./heart-DstOrYv-.js";const O=()=>{const{t:s}=A(),{addNotification:d}=M(),{isConnected:h,publicKey:x}=R(),[g,m]=r.useState(!0),[v,w]=r.useState([]),[T,S]=r.useState([]),[l,y]=r.useState(null),[o,b]=r.useState(null),[F,p]=r.useState(!1),[n,u]=r.useState("propose");r.useEffect(()=>{h&&(async()=>{m(!0);try{if(!x)return;const t=await(await fetch(`https://api.example.com/profile/${x.toBase58()}/nfts`)).json();w(t.nftsCollected||[]);const k=await(await fetch("https://api.example.com/nfts/available-for-swap")).json();S(k.filter(C=>C.ownerAddress!==x.toBase58()))}catch(i){console.error("Failed to fetch NFTs for exchange:",i),d({type:"error",title:s("error"),message:s("Failed to load NFTs for exchange")})}finally{m(!1)}})()},[h,x,d,s]);const P=async()=>{if(!l||!o){d({type:"warning",title:s("Invalid Selection"),message:s("Please select both your NFT and the target NFT")});return}m(!0);try{const a=await fetch("https://api.example.com/swap/propose",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proposerNFTId:l.id,targetNFTId:o.id,proposerAddress:x.toBase58(),targetAddress:o.owner.address})});if(!a.ok){const i=await a.json();throw new Error(i.message||`HTTP error! status: ${a.status}`)}d({type:"success",title:s("success"),message:s("Swap proposal submitted successfully!")}),p(!1),y(null),b(null)}catch(a){console.error("Failed to propose swap:",a),d({type:"error",title:s("error"),message:s("Failed to submit swap proposal. Please try again.")})}finally{m(!1)}},N=(a,i,t)=>e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-96 overflow-y-auto p-2 rounded-lg bg-gray-800",children:a.length>0?a.map(c=>e.jsxs("div",{className:`relative cursor-pointer rounded-lg overflow-hidden transition-all duration-200 ${(t==null?void 0:t.id)===c.id?"border-2 border-primary":"border-2 border-transparent"}`,onClick:()=>i(c),children:[e.jsx(f,{nft:c}),(t==null?void 0:t.id)===c.id&&e.jsx("div",{className:"absolute inset-0 bg-primary/30 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-2xl",children:"✓"})})]},c.id)):e.jsx("p",{className:"col-span-full text-center text-gray-400 py-8",children:s("noNFTsAvailable")})});return h?e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-6",children:s("exchange.title")}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"bg-card p-1 rounded-lg flex space-x-1",children:[e.jsx("button",{onClick:()=>u("propose"),className:`py-2 px-4 rounded-md text-sm font-medium ${n==="propose"?"bg-primary text-black":"text-gray-400 hover:text-white"}`,children:s("exchange.proposeSwap")}),e.jsx("button",{onClick:()=>u("myProposals"),className:`py-2 px-4 rounded-md text-sm font-medium ${n==="myProposals"?"bg-primary text-black":"text-gray-400 hover:text-white"}`,children:s("exchange.myProposals")}),e.jsx("button",{onClick:()=>u("incomingProposals"),className:`py-2 px-4 rounded-md text-sm font-medium ${n==="incomingProposals"?"bg-primary text-black":"text-gray-400 hover:text-white"}`,children:s("exchange.incomingProposals")})]})}),g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(j,{size:"lg"})}):e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 space-y-6",children:[n==="propose"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s("exchange.yourNFTsForSwap")}),N(v,y,l)]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s("exchange.targetNFTsForSwap")}),N(T,b,o)]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>p(!0),disabled:!l||!o,className:"px-6 py-3 bg-primary text-black rounded-lg hover:bg-primary/80 transition-colors disabled:opacity-50",children:s("exchange.proposeSwap")})})]}),n==="myProposals"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s("exchange.mySentProposals")}),e.jsx("p",{className:"text-gray-400",children:s("exchange.noSentProposals")})]}),n==="incomingProposals"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:s("exchange.myReceivedProposals")}),e.jsx("p",{className:"text-gray-400",children:s("exchange.noReceivedProposals")})]})]})]}),e.jsx(E,{isOpen:F,onClose:()=>p(!1),title:s("exchange.confirmSwapProposal"),children:l&&o&&e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-lg font-semibold",children:s("exchange.youAreProposingToSwap")}),e.jsxs("div",{className:"flex justify-around items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(f,{nft:l}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:s("exchange.yourNFT")})]}),e.jsx("span",{className:"text-2xl font-bold mx-4",children:"↔️"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(f,{nft:o}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:s("exchange.theirNFT")})]})]}),e.jsx("p",{className:"text-sm text-gray-400",children:s("exchange.swapDisclaimer")}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-gray-400 hover:text-white",children:s("cancel")}),e.jsx("button",{onClick:P,disabled:g,className:"px-4 py-2 bg-primary text-black rounded-lg hover:bg-primary/80 disabled:opacity-50",children:g?e.jsx(j,{size:"sm"}):s("exchange.confirmProposal")})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("wallet.connectYourWallet")}),e.jsx("p",{className:"text-gray-400 mb-6",children:s("wallet.connectToUseExchange")})]})})};export{O as default};
